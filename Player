import java.util.ArrayList;
import java.util.Arrays;
import java.util.Random;

public class Player extends Thread{
    private int playerNumber;
    private int deckNum;
    private Card[] playerHandArray;
    private Card[] playerDeckArray;
    private Card[] pickDeck;
    private Card[] discardDeck;

    public Player(int PlayerNumber, int deckNum) { //parse the deck num through
        this.playerNumber = PlayerNumber;
        this.deckNum = deckNum;
        this.playerHandArray = new Card[4]; //0 to 4 where 4 is the add/remove hand
        this.playerDeckArray = new Card[deckNum];
    }

    public int getPlayerNumber() {
        return playerNumber;
    }

    public int getDeckNum(){
        return deckNum;
    }

    public Card[] getPlayerHandArray() {
        return playerHandArray;
    }

    public Card[] getPlayerDeckArray() {
        return playerDeckArray;
    }

    public Card[] getPickDeck() {
        return discardDeck;
    }

    public void setPickDeck(Card[] pickDeck){
        this.pickDeck = pickDeck;
    }
    public void setDiscardDeck(Card[] discardDeck){
        this.discardDeck = discardDeck;
    }

    public void newDeck(Card[] newPickupDeck){
        this.playerDeckArray = newPickupDeck;
    }
    //This resets the hand so each card discard attribute is set to false
    public void resetHand() {
        for (int i = 0; i < playerHandArray.length; i++) {
            playerHandArray[i].setToKeep();
        }
    }
    public void resetDeck() {
        for(int i = 0; i < playerDeckArray.length; i++) {
            playerDeckArray[i].reset();
        }
    }

    public void incrementTimeStep() {
        for (int eachCard = 0; eachCard < playerHandArray.length; eachCard++) {
            Card currentCard = playerHandArray[eachCard];
            currentCard.setTimeStep();
        }
    }

    public void turn(int index){
        resetHand();
        resetDeck();
        Card cardToDiscard = playerHandArray[index];

    }

    //Following code checks if a player has won
    public boolean checkWin() {
    //Gathers together card values
        int[] cardNumbers = new int[4];
        for (int eachCard = 0; eachCard < playerHandArray.length; eachCard++) {
            cardNumbers[eachCard] = playerHandArray[eachCard].getIndexValue();
        }

        //Checking if the card values are the same
        int comparisonValue = cardNumbers[0];
        for (int eachValue = 1; eachValue < cardNumbers.length; eachValue++) {
            if (comparisonValue != cardNumbers[eachValue]) {
                return false;
            }
        }
        return true;
    }



    //Searches the hand of the player to find a certain card number
    public boolean searchCardNumber(int cardNumber) {
        for (int eachCard = 0; eachCard < playerHandArray.length; eachCard++) {
            int currentCardNum = playerHandArray[eachCard].getIndexValue();
            if (currentCardNum == cardNumber) {
                return true;
            }
        }
        return false;
    }
    //Finds card where the index is the player number and changes discard attribute
    public void decideKeep() {
        if (searchCardNumber(playerNumber) == true) {
            for (int g = 0; g < playerHandArray.length; g++) {
                int currentCardNum = playerHandArray[g].getIndexValue();
                if (currentCardNum == playerNumber) {
                    playerHandArray[g].setToKeep();
                } else {
                    playerHandArray[g].setToDiscard();
                }
            }
        }
    }



    public void decideDiscard(){
        Card[] playerHandArray = getPlayerHandArray();
        int[] tempArray = new int[4];
        for (int i = 0; i < playerHandArray.length; i++) {
            tempArray[i] = playerHandArray[i].getIndexValue();
        }
        Arrays.sort(tempArray);

        int cardNumAmount = 1;
        int tempValue;
        int winingVal = tempArray[0];
        int count = 0;
        for (int i = 0; i < (tempArray.length); i++) {
            count = 1;
            tempValue = tempArray[i];

            for (int j = i+1; j < tempArray.length; j++) {
                int againstVal = tempArray[j];
                if (tempValue == againstVal) {
                    count++;
                }
            }if(count > cardNumAmount) {
                winingVal = playerHandArray[i].getIndexValue();
                cardNumAmount = count;
            }

        }

        if(cardNumAmount > 1 ) {
            for (int i = 0; i < playerHandArray.length; i++) {
                if (winingVal == playerHandArray[i].getIndexValue()) {
                    playerHandArray[i].setToKeep();
                } else {
                    playerHandArray[i].setToDiscard();
                }
            }
        }
        else{
            for (int i = 0; i < playerHandArray.length; i++) {
                playerHandArray[i].setToDiscard();
            }
        }
    }



    //Returns index to which card should be removed from the players hand array
    public int findDiscardIndex(){
        ArrayList<Integer> removeIndexes = new ArrayList<Integer>();
        ArrayList<Integer> removePriorityIndex = new ArrayList<Integer>();
        for (int i = 0; i < playerHandArray.length; i++) {
            if(playerHandArray[i].getDiscard() == true){
                if(playerHandArray[i].getTimeStep() > 2){ /// 3 ?
                    removePriorityIndex.add(i);
                }else {
                    removeIndexes.add(i);
                }
            }
        }
        Random rand = new Random();
        int randomIndexToRemove = 0;
        int index = 0;
        int removePosition = 0;
        if(removePriorityIndex.size() > 0){
            randomIndexToRemove = rand.nextInt(removePriorityIndex.size());
            index = removePriorityIndex.get(randomIndexToRemove);
            removePosition = removePriorityIndex.indexOf(index);
            removePriorityIndex.remove(removePosition);
            for(int j = 0; j < removePriorityIndex.size(); j++) {
                for(int i = 0; i < playerHandArray.length; i++) {
                    if(removePriorityIndex.get(j) == i) {
                        playerHandArray[i].setTimeStep();
                    }
                }
            }
        }else {
            randomIndexToRemove = rand.nextInt(removeIndexes.size());
            index = removeIndexes.get(randomIndexToRemove);
            removePosition = removeIndexes.indexOf(index);
            removeIndexes.remove(removePosition);
            for(int j = 0; j < removeIndexes.size(); j++) {
                for(int i = 0; i < playerHandArray.length; i++) {
                    if(removeIndexes.get(j) == i) {
                        playerHandArray[i].setTimeStep();
                    }
                }
            }
        }
        return index;
    }

}
